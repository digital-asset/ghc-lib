sudo: required

os:
- linux
- osx

services:
- docker

before_install:
- |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      docker pull alpine/git
      docker run -ti --rm -v ${HOME}:/root -v $(pwd):/git alpine/git clone https://gitlab.haskell.org/ghc/ghc.git /git/ghc --recursive
      EOF
    else
      git clone https://gitlab.haskell.org/ghc/ghc.git --recursive
    fi
    cat >> ghc/hadrian/stack.yaml <<EOF
    ghc-options:
        "$everything": -O0 -j
    EOF

script:
# - curl -sSL https://raw.github.com/ndmitchell/hlint/master/misc/travis.sh | sh -s .
- curl -sSL https://get.haskellstack.org/ | sh
- stack setup > /dev/null
- stack --no-terminal build
- stack runhaskell CI.hs
